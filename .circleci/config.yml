version: 2.0

jobs:
  test:
    parallelism: 2
    docker:
      - image: circleci/openjdk:stretch
    steps:
      - checkout
#      - run: ./mvnw test | circleci tests split --split-by=timings
      - run: ./mvnw -Dtest=$(for file in $(circleci tests glob "src/test/**/**.java") test | circleci tests split --split-by=timings)
      - store_test_results:
          path: target/surefire-reports

#
#  build:
#    docker:
#      - image: circleci/openjdk:stretch
#    steps:
#      - checkout
#      - run: ./mvnw -Dmaven.test.skip=true package

workflows:
  version: 2
#
#  build:
#    jobs:
#      - build

  build-then-test:
    jobs:
      - test
#      - build:
#          requires:
#            - test
